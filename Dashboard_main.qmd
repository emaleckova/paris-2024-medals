---
format:
  dashboard:
    logo: images/Paris2024_Mono_Blanc.png
    orientation: rows
    main-font: gowun-dodum
    expandable: false

execute:
  echo: false
  warning: false
  error: false
---

<!-- H1 = PAGE -->

# Olympics in numbers

```{r}
#| label: r-session-setup

# data wrangling
library(tidyverse)
library()
# html and icons
library(htmltools)
library(bslib)
library(bsicons)
library(icons)
# tables
library(gt)
library(tabulapdf) # from pdf
# maps + country codes
library(rnaturalearth)
library(sf)
library(cartogram)
library(countrycode)
# plots
library(ggiraph)
library(scatterpie)
library(gganimate)
library(ggtext)
library(scales)
```

```{r}
#| label: general-visuals

### Medal colours
col_medals <- c("#FCC65B", "#E5E5E5", "#E0BD95")
names(col_medals) <- c("Gold", "Silver", "Bronze")

### Gender colours
col_genders <- c("#304BBC", "#A53771")

### Paris 2024 colours
col_paris <- c("#f292b7", "#d6be76", "#1d87c2", "#002e54", "#a499c3")
```


```{r}
#| label: get-data

### All NOCs
all_noc <- read.delim("data/nocs.csv", sep = ",", header = T)
# These include historical territories as well - exclude them
noc_present <- filter(all_noc, note == "P")

### Participating athletes
athletes_dat <- read.delim("data/athletes.csv", sep = ",", header = T)

### Nations with medals
nations_dat <- read.delim("data/medals_total.csv", sep = ",", header = T)

### Medalists
medalists_dat <- read.delim("data/medallists.csv", sep = ",", header = T)
# this will unify terms used for the medal types
medalists_dat$medal_type <- gsub(" Medal", "", medalists_dat$medal_type)

### Schedule
schedule_dat <- read.delim("data/schedules.csv", sep = ",", header = T)
```

```{r}
#| label: overview-stats

### AIM: Get NOCs vs qualified vs with at least one medal

# All NOCs
n_noc_all <- nrow(noc_present)

# NOCs qualified
n_noc_qualified <- length(unique(athletes_dat$country_code))

# NOCs with medals
n_noc_medals <- length(unique(nations_dat$country_code))


### AIM: Medal-winning competitions

# Total of medal sets awarded
n_awards <- sum(schedule_dat$event_medal)
```

## ROW: Subset of cards

### COL : Card 1 {height="20%"}
```{r}
#| label: valuebox-medal-competitions

bslib::value_box(
  title = tags$h3("Medal ceremonies", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-dblue",
  showcase = bs_icon("award-fill"),
  value = tags$p(n_awards, style = "font-size: 42px; font-face: bold;")
)
```

### COL: Card 2 {height="20%"}

```{r}
#| label: valuebox-all-nocs

bslib::value_box(
  title = tags$h3("Registered NOCs", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-dblue",
  showcase = bs_icon("globe2"),
  value = tags$p(n_noc_all, style = "font-size: 42px; font-face: bold;")
)
```

### COL: Card 3 {height="20%"}

```{r}
#| label: valuebox-nocs-qual

bslib::value_box(
  title = tags$h3("Qualified NOCs", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-dblue",
  showcase = bs_icon("check2-all"),
  value = tags$p(n_noc_qualified, style = "font-size: 42px; font-face: bold;")
)
```

### COL: Card 4 {height="20%"}

```{r}
#| label: valuebox-nocs-medals

bslib::value_box(
  title = tags$h3("NOCs with medalists", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-dblue",
  showcase = bs_icon("award"),
  value = tags$p(n_noc_medals, style = "font-size: 42px; font-face: bold;")
)
```

## ROW: Genders

```{r}
#| label: get-athletes-by-gender

n_men <- athletes_dat |> 
  filter(gender == "Male" & function. == "Athlete") |> 
  select(country, name, disciplines) |> 
  distinct() |> 
  nrow()

n_women <- athletes_dat |> 
  filter(gender == "Female" & function. == "Athlete") |> 
  select(country, name, disciplines) |> 
  distinct() |> 
  nrow()
```

### COL: Men's card {height="20%"}

```{r}
#| label: valuebox-male-athletes

bslib::value_box(
  title = tags$h3("Male athletes", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-blue",
  showcase = bs_icon("gender-male"),
  value = tags$p(n_men, style = "font-size: 42px; font-face: bold;")
)
```

### COL: Women's card {height="20%"}

```{r}
#| label: valuebox-female-athletes

bslib::value_box(
  title = tags$h3("Female athletes", style = "cont-size: 20px;"),
  theme = "bg-theme-paris-pink",
  showcase = bs_icon("gender-female"),
  value = tags$p(n_women, style = "font-size: 42px; font-face: bold;")
)
```

### COL: Facts about the Games {height="50%"}

These are some impressive numbers about the 32^nd^ Summer olympics held in Paris from July 26 to August 11, 2024. The Paris Games were exceptional in many other aspects - let's explore a selection together. 


## ROW: Plot genders in time {height="50%" width="50%"}

```{r}
#| label: get-female-participation-data

source("Rscripts/ExtractHistoricalFemaleData.R")
remove(female_tbls)
```

```{r}
#| label: figure-historical-female-participation

# n of frames ~ n of years with data
n_frames = length(unique(female_dat$Year))

gender_plot_title <- paste0("**<span style='color:", col_paris[3], "'>Male</span> and ", "<span style='color:", col_paris[1], "'>female</span> athletes in Summer Olympics: 1900-2024**")

# long format for plotting
p_genders <- female_dat |> 
  pivot_longer(cols = c("Prcnt_women_participants", "Prcnt_men_participants"), values_to = "Prcnt", names_to = "Gender") |> 
  ggplot(aes(x = Year, y = Prcnt, group = Gender)) +
  geom_line(aes(colour = Gender), linewidth = 1.25) +
  scale_colour_manual(values = c("Prcnt_men_participants" = col_paris[3], "Prcnt_women_participants" = col_paris[1])) +
  scale_x_continuous(expand = c(0, 0),
                     breaks = unique(female_dat$Year)) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = gender_plot_title) +
  theme_minimal() +
  theme(plot.title = element_markdown(hjust = 0.5),
        axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5),
        axis.title = element_blank(),
        aspect.ratio = 0.5,
        legend.position = "none")

anim_genders <- p_genders +
  transition_reveal(along = Year)

animate(anim_genders, nframes = n_frames, duration = 7)
```




<!-- -------------------------------------------------------------------------- -->

<!-- -------- -->
<!-- New page -->

# Participating nations {orientation="columns"}

{{< include _TopNations.qmd >}}

# Top medallists {orientation="columns"}

{{< include _TopMedallists.qmd >}}


<!-- IDEAS: Total men and women, disciplines with most events/medals? -->

# About

**Motivation:**  

I made this website to practice use of Quarto dashboards and deployment to public.

